# 非素数模数的计算&&Lucas定理

## 非素数模数的普遍计算

### 常规方法

以组合数为例。

对模数m进行因数分解，每个出现的因数存下来，这样最多十几个因数。

然后每次乘一个数之前，就检验是否包含得到的因数，包含就计数并且除掉，不计算到逆元和阶乘的前缀里。

设数组C[i][j]表示阶乘乘到i时，对于前面得到的第j个质数，能分解出C[i][j]个。

这样在计算fac[n]×inv[n-m]×inv[m]之后，只需要再计算出上下因子个数的差，计算出没有乘上的因子，乘上去即可。

### 中国剩余定理解法

感觉有点fake。

分解模数为互质的数，分别计算，再用中国剩余定理求解，不过有相应因子的还是要先除掉，最后再乘。

## Lucas定理(p是素数)

Lucas(n,m)=C(n,m)%p

Lucas(n,m)=C(n%p,m%p)∗Lucas(n/p,m/p)%p

```C++
ll Lucas(ll n,ll m,ll p){
    if(m==0)return 1;
    return C(n%p,m%p)*Lucas(n/p,m/p)%p;
}
```